{
  "//": {
    "metadata": {
      "backend": "remote",
      "cloud": "tfc",
      "stackName": "audit",
      "version": "0.15.5"
    },
    "outputs": {
      "audit": {
        "audit-last-updated": "audit-last-updated"
      }
    }
  },
  "data": {
    "aws_caller_identity": {
      "mgmt-acct-identity": {
        "//": {
          "metadata": {
            "path": "audit/mgmt-acct-identity",
            "uniqueId": "mgmt-acct-identity"
          }
        },
        "provider": "aws"
      }
    },
    "aws_iam_policy_document": {
      "audit_bucket": {
        "//": {
          "metadata": {
            "path": "audit/audit_bucket",
            "uniqueId": "audit_bucket"
          }
        },
        "statement": [
          {
            "actions": [
              "s3:GetBucketAcl"
            ],
            "principals": [
              {
                "identifiers": [
                  "cloudtrail.amazonaws.com"
                ],
                "type": "Service"
              }
            ],
            "resources": [
              "${aws_s3_bucket.audit-bucket.arn}"
            ],
            "sid": "AWSCloudTrailAclCheck20150319"
          },
          {
            "actions": [
              "s3:PutObject"
            ],
            "condition": [
              {
                "test": "StringEquals",
                "values": [
                  "arn:aws:cloudtrail:us-east-2:${data.aws_caller_identity.mgmt-acct-identity.id}:trail/nuon-org-trail"
                ],
                "variable": "aws:SourceArn"
              },
              {
                "test": "StringEquals",
                "values": [
                  "bucket-owner-full-control"
                ],
                "variable": "s3:x-amz-acl"
              }
            ],
            "principals": [
              {
                "identifiers": [
                  "cloudtrail.amazonaws.com"
                ],
                "type": "Service"
              }
            ],
            "resources": [
              "${aws_s3_bucket.audit-bucket.arn}/AWSLogs/${data.aws_caller_identity.mgmt-acct-identity.id}/*"
            ],
            "sid": "AWSCloudTrailWrite20150319Mgmt"
          },
          {
            "actions": [
              "s3:PutObject"
            ],
            "condition": [
              {
                "test": "StringEquals",
                "values": [
                  "arn:aws:cloudtrail:us-east-2:${data.aws_caller_identity.mgmt-acct-identity.id}:trail/nuon-org-trail"
                ],
                "variable": "aws:SourceArn"
              },
              {
                "test": "StringEquals",
                "values": [
                  "bucket-owner-full-control"
                ],
                "variable": "s3:x-amz-acl"
              }
            ],
            "principals": [
              {
                "identifiers": [
                  "cloudtrail.amazonaws.com"
                ],
                "type": "Service"
              }
            ],
            "resources": [
              "${aws_s3_bucket.audit-bucket.arn}/AWSLogs/${data.terraform_remote_state.cross-stack-reference-input-org.outputs.cross-stack-output-aws_organizations_organizationorgid}/*"
            ],
            "sid": "AWSCloudTrailWrite20150319Org"
          }
        ]
      }
    },
    "terraform_remote_state": {
      "cross-stack-reference-input-org": {
        "backend": "remote",
        "config": {
          "hostname": "app.terraform.io",
          "organization": "launchpaddev",
          "workspaces": {
            "name": "aws"
          }
        }
      }
    }
  },
  "output": {
    "audit-last-updated": {
      "description": "The timestamp of when the module was last applied. Useful for forcing applies on upgrade",
      "value": "2023-03-26T00:12:02.813Z"
    }
  },
  "provider": {
    "aws": [
      {
        "alias": "audit",
        "assume_role": [
          {
            "role_arn": "arn:aws:iam::${data.terraform_remote_state.cross-stack-reference-input-org.outputs.cross-stack-output-aws_organizations_accountauditid}:role/OrganizationAccountAccessRole"
          }
        ],
        "default_tags": [
          {
            "tags": {
              "environment": "management",
              "terraform": "infra-aws"
            }
          }
        ],
        "region": "us-east-2"
      },
      {
        "default_tags": [
          {
            "tags": {
              "environment": "management",
              "terraform": "infra-aws"
            }
          }
        ],
        "region": "us-east-2"
      }
    ]
  },
  "resource": {
    "aws_cloudtrail": {
      "audit-cloudtrail": {
        "//": {
          "metadata": {
            "path": "audit/audit-cloudtrail",
            "uniqueId": "audit-cloudtrail"
          }
        },
        "depends_on": [
          "aws_s3_bucket_policy.audit-bucket-policy-attachment"
        ],
        "include_global_service_events": true,
        "is_multi_region_trail": true,
        "is_organization_trail": true,
        "name": "nuon-org-trail",
        "s3_bucket_name": "${aws_s3_bucket.audit-bucket.bucket}"
      }
    },
    "aws_s3_bucket": {
      "audit-bucket": {
        "//": {
          "metadata": {
            "path": "audit/audit-bucket",
            "uniqueId": "audit-bucket"
          }
        },
        "bucket": "nuon-audit-bucket",
        "provider": "aws.audit"
      }
    },
    "aws_s3_bucket_lifecycle_configuration": {
      "audit-bucket-lifecycle": {
        "//": {
          "metadata": {
            "path": "audit/audit-bucket-lifecycle",
            "uniqueId": "audit-bucket-lifecycle"
          }
        },
        "bucket": "${aws_s3_bucket.audit-bucket.bucket}",
        "provider": "aws.audit",
        "rule": [
          {
            "expiration": {
              "days": 365
            },
            "id": "default-transition-rule",
            "status": "Enabled",
            "transition": [
              {
                "days": 30,
                "storage_class": "STANDARD_IA"
              },
              {
                "days": 60,
                "storage_class": "GLACIER"
              }
            ]
          }
        ]
      }
    },
    "aws_s3_bucket_policy": {
      "audit-bucket-policy-attachment": {
        "//": {
          "metadata": {
            "path": "audit/audit-bucket-policy-attachment",
            "uniqueId": "audit-bucket-policy-attachment"
          }
        },
        "bucket": "${aws_s3_bucket.audit-bucket.id}",
        "policy": "${data.aws_iam_policy_document.audit_bucket.json}",
        "provider": "aws.audit"
      }
    },
    "aws_s3_bucket_server_side_encryption_configuration": {
      "audit-bucket-encryption": {
        "//": {
          "metadata": {
            "path": "audit/audit-bucket-encryption",
            "uniqueId": "audit-bucket-encryption"
          }
        },
        "bucket": "${aws_s3_bucket.audit-bucket.bucket}",
        "provider": "aws.audit",
        "rule": [
          {
            "apply_server_side_encryption_by_default": {
              "sse_algorithm": "aws:kms"
            },
            "bucket_key_enabled": true
          }
        ]
      }
    }
  },
  "terraform": {
    "backend": {
      "remote": {
        "hostname": "app.terraform.io",
        "organization": "launchpaddev",
        "workspaces": {
          "name": "aws-audit"
        }
      }
    },
    "required_providers": {
      "aws": {
        "source": "aws",
        "version": "4.60.0"
      }
    }
  }
}