---
title: 'Terraform Components'
description: "Terraform components allow you to provision infrastructure in your customer's cloud account to power your install."
---

Terraform components allow you to deploy Terraform from a public or connected repo, to provision infrastructure
resources in customer installs. Please refer to the [Terraform
reference](https://registry.terraform.io/providers/nuonco/nuon/latest/docs/resources/terraform_module_component) for
full configuration options.

<Note>
In order for Terraform modules to properly work with Nuon, they must specify an `s3 {}` backend for state. [Read more below](#state-management) for more details.
</Note>

## Configuring a Terraform component

To configure a Terraform component, specify a repo, the required configuration values, and the version of Terraform to run it with.

<CodeGroup>
```toml TOML
[[components]]
name              = "infra"
type              = "terraform_module"
terraform_version = "1.6.3"
[components.connected_repo]
directory = "components/infra"
repo      = "<your-org>/<your-repo>"
branch    = "main"
```

```hcl Terraform
resource "nuon_terraform_module_component" "infra" {
  name              = "infra"
  app_id            = nuon_app.<your-app>.id
  terraform_version = "1.6.3"

  connected_repo = {
    directory = "components/infra"
    repo      = "<your-org>/<your-repo>"
    branch    = "main"
  }
}
```
</CodeGroup>

You can configure Terraform components to use either a public repo (using a `public_repo` block) or a private GitHub
repo (using a `connected_repo` block). Read more about VCS configuration [here](/guides/vcs).

## Configuring Terraform Vars

You can configure terraform variables for a component using [component variables](/guides/using-variables).

These variables can access inputs, other components, the sandbox, and details on the install itself.

<CodeGroup>
```toml TOML
[[components]]
name              = "lambda_function"
type              = "terraform_module"
terraform_version = "1.6.3"
[components.connected_repo]
directory = "components/lambda-function"
repo      = "<your-org>/<your-repo>"
branch    = "main"
[components.env_vars]
AWS_REGION = "{{.nuon.install.sandbox.outputs.account.region}}"
[components.vars]
database_instance = "{{.nuon.install.inputs.database_instance}}"
```

```hcl Terraform
resource "nuon_terraform_module_component" "lambda_function" {
  name   = "lambda_function"
  app_id = nuon_app.<your-app>.id
  terraform_version = "1.6.3"

  connected_repo = {
    directory = "components/lambda-function"
    repo      = "<your-org>/<your-repo>"
    branch    = "main"
  }

  env_var {
    name = "AWS_REGION"
    value = "{{.nuon.install.sandbox.outputs.account.region}}"
  }

  var {
    name = "database_instance"
    value = "{{.nuon.install.inputs.database_instance}}"
  }
}
```
</CodeGroup>

## Configuring Env Vars

## State Management

All Terraform state is managed using an S3 backend, within the Nuon platform.

In order for Terraform modules to be compatible with Nuon, and not lose state, they must set the backend to the [s3
backend](https://developer.hashicorp.com/terraform/language/settings/backends/s3).

```hcl
terraform {
  required_version = ">= 1.3.7"

  backend "s3" {}

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = ">= 4.0"
    }
  }
}
```

## Execution and Permissions

The [runner](/concepts/runners) is responsible for executing Terraform, which means that Terraform is executed from _within_
the Kubernetes cluster in K8S sandboxes, and from within ECS Fargate for `aws-ecs` sandboxes. In both cases, this is
inside of the install network.

Since Terraform is executed from within the install sandbox, Terraform resources can access both resources within the network (such as internal APIs,) and, in K8S sandboxes, the local Kubernetes
cluster.

The runner uses a dedicated IAM role defined in the sandbox when executing Terraform.
