---
title: 'Sandboxes'
description: "Sandboxes manage the base layer infrastructure for your application in each customer's cloud account."
---

Sandboxes are used to manage the base layer infrastructure of an app. Please refer to the [Terraform
reference](https://registry.terraform.io/providers/nuonco/nuon/latest/docs/resources/app_sandbox) for full configuration
options.

## What is a sandbox?

Sandboxes create a consistent, isolated environment that your application can be guaranteed to work with, across hundreds or
thousands of different installs. They are responsible for defining the basic networking, permissioning, and compute
primitives to power the app.

In a shared responsiblity model, a customer may provide some infrastructure in the sandbox, such as an
existing network or compute cluster. In this case, Nuon sandboxes enable you to leverage this customer infrastructure,
while also having a consistent way to deploy and manage your app in any account.

<Note>
Sandboxes ensure you can install your app into any account - whether a completely new account with no prior provisioning, or an account with other workflows.

Sandboxes can ensure isolation, reproducability and repeatability with each install - regardless of the account.
</Note>

## Configuring a Sandbox

To configure a sandbox, specify a repo and the correct parameters for your sandbox.

<CodeGroup>
```toml TOML
[sandbox]
terraform_version = "v1.6.3"
[sandbox.public_repo]
repo = "nuonco/sandboxes"
directory = "aws-eks"
branch = "main"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id            = nuon_app.main.id
  terraform_version = "v1.6.3"

  public_repo = {
    repo      = "nuonco/sandboxes"
    directory = "aws-eks"
    branch    = "main"
  }
}
```
</CodeGroup>

You can configure sandboxes to use either a public repo (using a `public_repo` block) or a private GitHub
repo (using a `connected_repo` block). Read more about VCS configuration [here](../guides/vcs).

## Nuon Managed Sandboxes

We maintain managed sandboxes for each [platform](./supported-platforms) that we support. Each platform has both a
turnkey (where all resources are provisioned) and a bring-your-own-vpc sandbox.
These sandboxes are designed to be a stable, configurable starting point and most relevant options around the network,
cluster and compute are configurable.

We publish each sandbox as a Terraform module.
They can all be found in the [Terraform Registry](https://registry.terraform.io/search/modules?namespace=nuonco&q=sandbox),
and you can find detailed documentation for each sandbox there.

Since you cannot use a Terraform module with Nuon directly, we also provide pre-configured Terraform projects that wrap them for convenient use.
You can find these in our [sandboxes repo](https://github.com/nuonco/sandboxes) on Github.
These projects are what you will reference in your sandbox config.

### AWS EKS

[AWS EKS](https://registry.terraform.io/modules/nuonco/eks-sandbox/aws/latest) is a sandbox for provisioning an EKS app. This sandbox
creates a new VPC, EKS cluster, IAM and installs a set of Helm resources.

<CodeGroup>
```toml TOML
[sandbox]
terraform_version = "v1.6.3"
[sandbox.public_repo]
repo = "nuonco/sandboxes"
directory = "aws-eks"
branch = "main"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id            = nuon_app.main.id
  terraform_version = "v1.6.3"

  public_repo = {
    repo      = "nuonco/sandboxes"
    branch    = "main"
    directory = "aws-eks"
  }
}
```
</CodeGroup>

### AWS EKS BYOVPC

[AWS EKS BYOVPC](https://registry.terraform.io/modules/nuonco/eks-byovpc-sandbox/aws/latest) is a sandbox for provisioning an EKS app
in a customer provider VPC. This sandbox creates a new EKS cluster, IAM and installs a set of Helm resources.

**NOTE** this sandbox requires an [app-input](./app-inputs) be declared to collect a customer provided `vpc_id`.

<CodeGroup>
```toml TOML
[inputs]
[[inputs.input]]
name = "vpc_id"
description = "The VPC to install the app in"
sensitive = false
display_name = "VPC ID"
required = true

[sandbox]
terraform_version = "v1.6.3"
[sandbox.public_repo]
repo = "nuonco/sandboxes"
directory = "aws-eks-byovpc"
branch = "main"
[[sandbox.var]]
name = "vpc_id"
value = "{{.nuon.install.inputs.vpc_id}}"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id            = nuon_app.main.id
  terraform_version = "v1.6.3"

  public_repo = {
    repo      = "nuonco/sandboxes"
    directory = "aws-eks"
    branch    = "main"
  }

  var {
    name = "vpc_id"
    value = "{{.nuon.install.inputs.vpc_id}}"
  }
}
```

```hcl inputs.tf
resource "nuon_app_input" "main" {
  app_id            = nuon_app.main.id

  input {
    name = "vpc_id"
    description = "customer provided vpc id"
    required = true
  }
}
```
</CodeGroup>

<Note>
In order for components to work with `aws-eks-byovpc` sandbox, subnets must be tagged in a way Nuon can look them up.

The `eks-byovpc` sandbox requires adding a `"kubernetes.io/role/internal-elb:1"` tag to all private subnets, and a `"kubernetes.io/role/elb:1"` tag to all public subnets.
</Note>

### AWS ECS

[AWS ECS](https://registry.terraform.io/modules/nuonco/ecs-sandbox/aws/latest) is a sandbox for provisioning an ECS app. This sandbox
creates a new VPC, ECS cluster and IAM resources.

<CodeGroup>
```toml TOML
[sandbox]
terraform_version = "v1.6.3"
[sandbox.public_repo]
repo = "nuonco/sandboxes"
directory = "aws-ecs"
branch = "main"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id            = nuon_app.main.id
  terraform_version = "v1.6.3"

  public_repo = {
    repo      = "nuonco/sandboxes"
    directory = "aws-ecs"
    branch    = "main"
  }
}
```
</CodeGroup>

### AWS ECS BYOVPC

[AWS ECS BYOVPC](https://registry.terraform.io/modules/nuonco/ecs-byovpc-sandbox/aws/latest) is a sandbox for provisioning an ECS app
in a customer provider VPC. This sandbox creates a new ECS Fargate cluster and IAM resources.

<Note>
This sandbox requires an [app-input](./app-inputs) be declared to collect a customer provided `vpc_id`.
</Note>

<CodeGroup>
```toml TOML
[inputs]
[[inputs.input]]
name = "vpc_id"
description = "The VPC to install the app in"
sensitive = false
display_name = "VPC ID"
required = true

[sandbox]
terraform_version = "v1.6.3"
[sandbox.public_repo]
repo = "nuonco/sandboxes"
directory = "aws-ecs-byovpc"
branch = "main"
[[sandbox.var]]
name = "vpc_id"
value = "{{.nuon.install.inputs.vpc_id}}"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id            = nuon_app.main.id
  terraform_version = "v1.6.3"

  public_repo = {
    repo      = "nuonco/sandboxes"
    branch    = "main"
    directory = "aws-ecs"
  }

  var {
    name = "vpc_id"
    value = "{{.nuon.install.inputs.vpc_id}}"
  }
}
```

```hcl inputs.tf
resource "nuon_app_input" "main" {
  app_id            = nuon_app.main.id

  input {
    name = "vpc_id"
    description = "customer provided vpc id"
    required = true
  }
}
```
</CodeGroup>

<Note>
In order for components to work with `aws-ecs-byovpc` sandboxes, subnets must be tagged in a way Nuon can look them up.

The `ecs-byovpc` sandbox requires adding a `visibility:private` tag to all private subnets, and a `visibility:public` tag to all public subnets.
</Note>

### Azure AKS

The [Azure AKS](https://registry.terraform.io/modules/nuonco/aks-sandbox/azure/latest) sandbox creates a VPN and an AKS cluster.

<CodeGroup>
```toml TOML
[sandbox]
terraform_version = "1.5.4"
[sandbox.public_repo]
repo = "nuonco/sandboxes"
directory = "azure-aks"
branch = "main"

[runner]
runner_type = "azure-aks"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id            = nuon_app.main.id
  terraform_version = "v1.6.3"

  public_repo = {
    repo      = "nuonco/sandboxes"
    directory = "aws-aks"
    branch    = "main"
  }
}

resource "nuon_app_runner" "main" {
  app_id      = nuon_app.main.id
  runner_type = "aws-aks"
}
```
</CodeGroup>

### Azure AKS BYOVPN

The [Azure AKS BYOVPN](https://registry.terraform.io/modules/nuonco/aks-byovpn-sandbox/azure/latest) sandbox creates an AKS cluster in a customer-provided VPN.

<CodeGroup>
```toml TOML
[inputs]
[[inputs.input]]
name = "resource_group_name"
description = "The Resource Group of the VPN to install the app in."
sensitive = false
display_name = "Resource Group Name"
required = true
[[inputs.input]]
name = "network_name"
description = "The VPN to install the app in."
sensitive = false
display_name = "Network Name"
required = true
[[inputs.input]]
name = "subnet_name"
description = "The Subnet in the VPN to install the app in."
sensitive = false
display_name = "Subnet Name"
required = true

[sandbox]
terraform_version = "1.5.4"
[sandbox.public_repo]
repo = "nuonco/sandboxes"
directory = "azure-aks"
branch = "main"
[[sandbox.var]]
name = "resource_group_name"
value = "{{.nuon.install.inputs.resource_group_name}}"
[[sandbox.var]]
name = "network_name"
value = "{{.nuon.install.inputs.network_name}}"
[[sandbox.var]]
name = "subnet_name"
value = "{{.nuon.install.inputs.subnet_name}}"

[runner]
runner_type = "azure-aks"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id = nuon_app.main.id
  terraform_version = "v1.6.3"

  public_repo = {
    repo = "nuonco/sandboxes"
    branch = "main"
    directory = "azure-aks-byovpn"
  }

  var {
    name = "resource_group_name"
    value = "{{.nuon.install.inputs.resource_group_name}}"
  }

  var {
    name = "network_name"
    value = "{{.nuon.install.inputs.network_name}}"
  }

  var {
    name = "subnet_name"
    value = "{{.nuon.install.inputs.subnet_name}}"
  }
}

resource "nuon_app_runner" "main" {
  app_id      = nuon_app.main.id
  runner_type = "aws-aks"
}
```

```hcl inputs.tf
resource "nuon_app_input" "main" {
  app_id = nuon_app.main.id

  input {
    name = "resource_group_name"
    description = "The Resource Group of the VPN to install the app in."
    sensitive = false
    display_name = "Resource Group Name"
    required = true
  }

  input {
    name = "network_name"
    description = "The VPN to install the app in."
    sensitive = false
    display_name = "Network Name"
    required = true
  }

  input {
    name = "subnet_name"
    description = "The Subnet in the VPN to install the app in."
    sensitive = false
    display_name = "Subnet Name"
    required = true
  }
}
```
</CodeGroup>

## Sandbox Updates

Nuon managed sandboxes are [open source](https://github.com/nuonco/sandboxes) and tagged using standard semver.

To pin any sandbox, you can set a tag such as `v0.0.1` as the branch field. Use the value `main` to use the latest
version at all times.

<CodeGroup>
```toml TOML
[sandbox]
terraform_version = "v1.6.3"
[sandbox.public_repo]
repo = "nuonco/sandboxes"
directory = "aws-eks"
branch = "v0.0.1"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id            = nuon_app.main.id
  terraform_version = "v1.6.3"

  public_repo = {
    repo      = "nuonco/sandboxes"
    branch    = "v0.0.1"
    directory = "aws-eks"
  }
}

```
</CodeGroup>

## Sandbox Outputs

Sandbox outputs are used by the Nuon platform to install the runner, and made accessible to all components [using variables](../guides/using-variables).

You can use any output from your selected sandbox by setting a config value on your component:

<CodeGroup>
```toml TOML
[[components]]
name   = "e2e_helm"
type = "helm_chart"
chart_name = "e2e-helm"
[components.public_repo]
repo      = "org/repo"
directory = "chart"
branch    = "main"
[[components.value]]
name  = "account_region"
value = "{{.nuon.install.sandbox.outputs.account.region}}"
```

```hcl helm.tf
resource "nuon_helm_chart_component" "e2e" {
  name   = "e2e_helm"
  app_id = nuon_app.main.id

  chart_name = "e2e-helm"
  connected_repo = {
    repo      = "org/repo"
    directory = "chart"
    branch    = "main"
  }

  value {
    name  = "account_region"
    value = "{{.nuon.install.sandbox.outputs.account.region}}"
  }
}
```
</CodeGroup>

## Configure Sandboxes

Each managed sandbox has a set of variable inputs. Most variables are either supplied by the Nuon platform during install, via inputs, or by setting default values.

### Use Default Values

To configure a sandbox parameter with a default value for your app:
<CodeGroup>
```toml TOML
[sandbox]
terraform_version = "v1.6.3"
[sandbox.public_repo]
repo = "nuonco/sandboxes"
directory = "aws-eks"
branch = "main"
[[sandbox.var]]
name = "cluster_version"
value = "1.28"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id            = nuon_app.main.id
  terraform_version = "v1.6.3"

  public_repo = {
    repo      = "nuonco/sandboxes"
    directory = "aws-eks"
    branch    = "main"
  }

  var {
    name = "cluster_version"
    value = "1.28"
  }
}
```
</CodeGroup>

### Use App Inputs

App inputs allow you to collect customer input values such as resource IDs, tokens and more. These inputs are accesible
to all components and your sandbox, [using variables](../guides/using-variables#inputs).

To configure a sandbox parameter using an app input:

<CodeGroup>
```toml TOML
[inputs]
[[inputs.input]]
name = "cluster_version"
description = "Kubernetes cluster version"
default = "v.1.27"

[sandbox]
terraform_version = "v1.6.3"
[sandbox.public_repo]
repo = "nuonco/sandboxes"
directory = "aws-eks"
branch = "main"
[[sandbox.var]]
name = "cluster_version"
value = "{{.nuon.install.inputs.cluster_version}}"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id            = nuon_app.main.id
  terraform_version = "v1.6.3"

  public_repo = {
    repo      = "nuonco/sandboxes"
    branch    = "main"
    directory = "aws-eks"
  }

  var {
    name = "cluster_version"
    value = "{{.nuon.install.inputs.cluster_version}}"
  }
}
```

```hcl input.tf
resource "nuon_app_input" "main" {
  app_id            = nuon_app.main.id

  input {
    name = "cluster_version"
    description = "Kubernetes cluster version"
    default = "v.1.27"
  }
}
```
</CodeGroup>

## Create a Custom Sandbox

While our [open source sandboxes](https://github.com/nuonco/sandboxes) are a great starting point, you can always fork them, or create your own sandbox to support customizing.

To use a custom sandbox, simply update your config to point to your new sandbox code. Custom sandboxes can also use private GitHub repos, that are connected to Nuon.


<CodeGroup>
```toml TOML
[sandbox]
terraform_version = "v1.6.3"
[sandbox.public_repo]
repo = "your-org/private-repo"
directory = "sandbox"
branch = "main"
```

```hcl sandbox.tf
resource "nuon_app_sandbox" "main" {
  app_id            = nuon_app.main.id
  terraform_version = "v1.6.3"

  connected_repo = {
    repo      = "your-org/private-repo"
    directory = "sandbox"
    branch    = "main"
  }
}
```
</CodeGroup>

<br />

<Note>
If one of our managed sandboxes does not work for you, and you are considering creating a custom sandbox, we would love to hear about your use case!

Please [get in touch](mailto:team@nuon.co).
</Note>
