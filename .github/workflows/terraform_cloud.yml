---
name: terraform cloud
"on":
  pull_request:
  push:
    branches:
      - main

permissions:
  contents: write
  id-token: write
  issues: read
  packages: write
  pull-requests: write
  statuses: write
  actions: read

concurrency:
  cancel-in-progress: ${{ github.event_name == 'pull_request' }}
  group: ${{ github.workflow }}-${{ github.head_ref || github.ref }}

defaults:
  run:
    shell: bash

jobs:
  changes:
    name: ğŸ” changes
    runs-on: ubuntu-latest
    outputs:
      tfcloud: ${{ steps.filter.outputs.changes }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v5

      - name: read ci triggers file
        uses: pietrobolcato/action-read-yaml@1.1.0
        id: ci_triggers
        with:
          config: ci-triggers.yml

      - uses: dorny/paths-filter@v3
        id: filter
        with:
          filters: ${{ steps.ci_triggers.outputs['terraform-cloud'] }}

  update_status:
    # since this runs as a matrix, name shows as `ğŸš¢ (workers-orgs)`
    name: ğŸš¢
    needs:
      - changes
    if: ${{ github.event_name == 'pull_request' && (needs.changes.outputs.tfcloud == '[]' || needs.changes.outputs.tfcloud == '') }}
    runs-on: ubuntu-latest
    steps:
      - uses: martialonline/workflow-status@v4.2
        id: check
      - name: Update status
        uses: ouzi-dev/commit-status-updater@v2.0.1
        with:
          name: 'Terraform Cloud/nuonco/repo-id-B14tP6vG7ia3CQHo'
          status: success
