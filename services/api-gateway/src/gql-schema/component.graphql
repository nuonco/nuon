##############################################################################
# Component Config GQL types
##############################################################################

"""
Represents no operation configuration
"""
type NoopConfig {
  noop: Boolean!
}

"""
Represents a Terraform module build configuration
"""
type TerraformBuildConfig {
  """
  Version control system configuration
  """
  vcsConfig: VcsConfig
}

"""
Represents settings for a public git repository
"""
type PublicGitConfig {
  repo: String!
  gitRef: String
  directory: String!
}

"""
Represents settings for a connected github repository
"""
type ConnectedGithubConfig {
  repo: String!
  gitRef: String
  directory: String!
  branch: String
}

"""
Represents version control settings for the component
"""
union VcsConfig = PublicGitConfig | ConnectedGithubConfig

"""
Represents a Docker build configuration
"""
type DockerBuildConfig {
  """
  Name of Dockerfile used to build image
  """
  dockerfile: String!
  """
  Docker build arguments
  """
  buildArgs: [KeyValuePair!]
  """
  Version control system configuration
  """
  vcsConfig: VcsConfig
  """
  Environment variables
  """
  envVarsConfig: [KeyValuePair!]
}

"""
Represents the AWS Authentication configuration used to access the vendor's OCI image
"""
type AWSAuthConfig {
  """
  AWS IAM Role
  """
  role: String!
  """
  AWS Region
  """
  region: AWSRegion!
}

"""
Represents an external OCI image configuration
"""
type ExternalImageConfig {
  """
  URL where the OCI image is hosted
  """
  ociImageUrl: String!
  """
  OCI image tag
  """
  tag: String!
  authConfig: AWSAuthConfig
}

"""
Represents a connected Helm Chart build configuration
"""
type HelmBuildConfig {
  """
  Name of the Helm Chart to build
  """
  chartName: String!
  """
  Version control system configuration
  """
  vcsConfig: VcsConfig
}

"""
Represents all the component build configurations
"""
union ComponentBuildConfig =
    ExternalImageConfig
  | DockerBuildConfig
  | HelmBuildConfig
  | NoopConfig
  | TerraformBuildConfig

"""
Represents a basic Kubernetes deployment configurations
"""
type BasicDeployConfig {
  """
  The health check endpoint for the Kubernetes liveness probe
  """
  healthCheckPath: String!
  """
  How many instances of deployment to maintain
  """
  instanceCount: Int!
  """
  Container port
  """
  port: Int!
}

"""
Represents a public helm chart deployment configuration
"""
type HelmRepoDeployConfig {
  chartName: String!
  chartRepo: String!
  chartVersion: String!

  imageRepoValuesKey: String
  imageTagValuesKey: String
}

"""
Represents a connected Helm Chart deployment configuration
"""
type HelmDeployConfig {
  """
  Temp noop until we know the required deploy config fields
  """
  noop: Boolean
  values: [KeyValuePair!]
}

enum TerraformVersion {
  TERRAFORM_VERSION_UNSPECIFIED
  TERRAFORM_VERSION_LATEST
  TERRAFORM_VERSION_1_4_6
  TERRAFORM_VERSION_1_4_5
  TERRAFORM_VERSION_1_4_4
  TERRAFORM_VERSION_1_4_3
  TERRAFORM_VERSION_1_4_2
  TERRAFORM_VERSION_1_4_1
  TERRAFORM_VERSION_1_3_9
  TERRAFORM_VERSION_1_3_8
  TERRAFORM_VERSION_1_3_7
  TERRAFORM_VERSION_1_3_6
  TERRAFORM_VERSION_1_3_5
  TERRAFORM_VERSION_1_3_4
  TERRAFORM_VERSION_1_3_3
  TERRAFORM_VERSION_1_3_2
  TERRAFORM_VERSION_1_3_1
  TERRAFORM_VERSION_1_2_9
  TERRAFORM_VERSION_1_2_8
  TERRAFORM_VERSION_1_2_7
  TERRAFORM_VERSION_1_2_6
  TERRAFORM_VERSION_1_2_5
  TERRAFORM_VERSION_1_2_4
  TERRAFORM_VERSION_1_2_3
  TERRAFORM_VERSION_1_2_2
  TERRAFORM_VERSION_1_2_1
  TERRAFORM_VERSION_1_0_11
  TERRAFORM_VERSION_1_0_10
  TERRAFORM_VERSION_1_0_9
  TERRAFORM_VERSION_1_0_8
  TERRAFORM_VERSION_1_0_7
  TERRAFORM_VERSION_1_0_6
  TERRAFORM_VERSION_1_0_5
  TERRAFORM_VERSION_1_0_4
  TERRAFORM_VERSION_1_0_3
  TERRAFORM_VERSION_1_0_2
  TERRAFORM_VERSION_1_0_1
  TERRAFORM_VERSION_0_15_5
  TERRAFORM_VERSION_0_15_4
  TERRAFORM_VERSION_0_15_3
  TERRAFORM_VERSION_0_15_2
  TERRAFORM_VERSION_0_15_1
  TERRAFORM_VERSION_0_14_11
  TERRAFORM_VERSION_0_14_10
  TERRAFORM_VERSION_0_14_9
  TERRAFORM_VERSION_0_14_8
  TERRAFORM_VERSION_0_14_7
  TERRAFORM_VERSION_0_14_6
  TERRAFORM_VERSION_0_14_5
  TERRAFORM_VERSION_0_14_4
  TERRAFORM_VERSION_0_14_3
  TERRAFORM_VERSION_0_14_2
  TERRAFORM_VERSION_0_14_1
  TERRAFORM_VERSION_0_13_7
  TERRAFORM_VERSION_0_13_6
  TERRAFORM_VERSION_0_13_5
  TERRAFORM_VERSION_0_13_4
  TERRAFORM_VERSION_0_13_3
  TERRAFORM_VERSION_0_13_2
  TERRAFORM_VERSION_0_13_1
  TERRAFORM_VERSION_0_12_31
  TERRAFORM_VERSION_0_12_30
  TERRAFORM_VERSION_0_12_29
  TERRAFORM_VERSION_0_12_28
  TERRAFORM_VERSION_0_12_27
  TERRAFORM_VERSION_0_12_26
  TERRAFORM_VERSION_0_12_25
  TERRAFORM_VERSION_0_12_24
  TERRAFORM_VERSION_0_12_23
  TERRAFORM_VERSION_0_12_22
  TERRAFORM_VERSION_0_12_21
  TERRAFORM_VERSION_0_12_20
  TERRAFORM_VERSION_0_12_19
  TERRAFORM_VERSION_0_12_18
  TERRAFORM_VERSION_0_12_17
  TERRAFORM_VERSION_0_12_16
  TERRAFORM_VERSION_0_12_15
  TERRAFORM_VERSION_0_12_14
  TERRAFORM_VERSION_0_12_13
  TERRAFORM_VERSION_0_12_12
  TERRAFORM_VERSION_0_12_11
  TERRAFORM_VERSION_0_12_10
  TERRAFORM_VERSION_0_12_9
  TERRAFORM_VERSION_0_12_8
  TERRAFORM_VERSION_0_12_7
  TERRAFORM_VERSION_0_12_6
  TERRAFORM_VERSION_0_12_5
  TERRAFORM_VERSION_0_12_4
  TERRAFORM_VERSION_0_12_3
  TERRAFORM_VERSION_0_12_2
  TERRAFORM_VERSION_0_12_1
  TERRAFORM_VERSION_0_11_15
  TERRAFORM_VERSION_0_11_14
  TERRAFORM_VERSION_0_11_13
  TERRAFORM_VERSION_0_11_12
  TERRAFORM_VERSION_0_11_11
  TERRAFORM_VERSION_0_11_10
  TERRAFORM_VERSION_0_11_9
  TERRAFORM_VERSION_0_11_8
  TERRAFORM_VERSION_0_11_7
  TERRAFORM_VERSION_0_11_6
  TERRAFORM_VERSION_0_11_5
  TERRAFORM_VERSION_0_11_4
  TERRAFORM_VERSION_0_11_3
  TERRAFORM_VERSION_0_11_2
  TERRAFORM_VERSION_0_11_1
  TERRAFORM_VERSION_0_10_8
  TERRAFORM_VERSION_0_10_7
  TERRAFORM_VERSION_0_10_6
  TERRAFORM_VERSION_0_10_5
  TERRAFORM_VERSION_0_10_4
  TERRAFORM_VERSION_0_10_3
  TERRAFORM_VERSION_0_10_2
  TERRAFORM_VERSION_0_10_1
  TERRAFORM_VERSION_0_9_11
  TERRAFORM_VERSION_0_9_10
  TERRAFORM_VERSION_0_9_9
  TERRAFORM_VERSION_0_9_7
  TERRAFORM_VERSION_0_9_6
  TERRAFORM_VERSION_0_9_5
  TERRAFORM_VERSION_0_9_4
  TERRAFORM_VERSION_0_9_3
  TERRAFORM_VERSION_0_9_2
  TERRAFORM_VERSION_0_9_1
  TERRAFORM_VERSION_0_8_8
}

"""
Represents a terraform module deployment configuration
"""
type TerraformDeployConfig {
  terraformVersion: TerraformVersion
  vars: [KeyValuePair!]
}

"""
Represents all the component deployment configurations
"""
union ComponentDeployConfig =
    BasicDeployConfig
  | HelmDeployConfig
  | HelmRepoDeployConfig
  | NoopConfig
  | TerraformDeployConfig

"""
Represents all configuration for the  component
"""
type ComponentConfig {
  buildConfig: ComponentBuildConfig
  deployConfig: ComponentDeployConfig
}

##############################################################################
# Component GQL types
##############################################################################

"""
Represents a collection of general settings and information about a piece of a App
"""
type Component implements Node {
  createdAt: DateTime!
  id: ID!
  name: String!
  updatedAt: DateTime!
  config: ComponentConfig
  deployments(options: ConnectionOptions): DeploymentConnection!
  app: App
}

"""
An auto-generated type which holds one Component and a cursor during pagination
"""
type ComponentEdge {
  """
  A cursor for use in pagination
  """
  cursor: String!
  """
  The item at the end of ComponentEdge
  """
  node: Component
}

"""
An auto-generated type for paginating through multiple Components
"""
type ComponentConnection implements Connection {
  totalCount: Int!
  pageInfo: PageInfo!
  """
  A list of edges
  """
  edges: [ComponentEdge!]
}

##############################################################################
# Component inputs
##############################################################################

input PublicGitConfigInput {
  repo: String!
  gitRef: String
  directory: String!
}

input ConnectedGithubConfigInput {
  repo: String!
  gitRef: String
  directory: String!
  branch: String!
}

input VcsConfigInput {
  publicGit: PublicGitConfigInput
  connectedGithub: ConnectedGithubConfigInput
}

input DockerBuildInput {
  buildArgs: [KeyValuePairInput!]
  dockerfile: String!
  envVarsConfig: [KeyValuePairInput!]
  vcsConfig: VcsConfigInput!
}

input TerraformBuildInput {
  vcsConfig: VcsConfigInput!
}

input AWSAuthConfigInput {
  role: String!
  region: AWSRegion!
}

input ExternalImageInput {
  ociImageUrl: String!
  tag: String
  authConfig: AWSAuthConfigInput
}

input HelmBuildInput {
  chartName: String!
  vcsConfig: VcsConfigInput!
}

input BuildConfigInput {
  noop: Boolean
  dockerBuildConfig: DockerBuildInput
  externalImageConfig: ExternalImageInput
  helmBuildConfig: HelmBuildInput
  terraformBuildConfig: TerraformBuildInput
}

input BasicDeployConfigInput {
  healthCheckPath: String!
  instanceCount: Int!
  port: Int!
}

input HelmRepoDeployConfigInput {
  chartName: String!
  chartRepo: String!
  chartVersion: String!

  imageRepoValuesKey: String
  imageTagValuesKey: String
}

input HelmDeployInput {
  noop: Boolean
  values: [KeyValuePairInput!]
}

input TerraformDeployConfigInput {
  terraformVersion: TerraformVersion
  vars: [KeyValuePairInput!]
}

input DeployConfigInput {
  noop: Boolean
  basicDeployConfig: BasicDeployConfigInput
  helmDeployConfig: HelmDeployInput
  helmRepoDeployConfig: HelmRepoDeployConfigInput
  terraformDeployConfig: TerraformDeployConfigInput
}

input ComponentConfigInput {
  buildConfig: BuildConfigInput
  deployConfig: DeployConfigInput
}

input ComponentInput {
  appId: ID
  id: ID
  name: String
  config: ComponentConfigInput
}

##############################################################################
# Component query types
##############################################################################

extend type Query {
  component(id: ID!): Component
  components(appId: ID!, options: ConnectionOptions): ComponentConnection!
}

##############################################################################
# Component mutation types
##############################################################################

extend type Mutation {
  deleteComponent(id: ID!): Boolean!
  upsertComponent(input: ComponentInput!): Component
}
