import '@test/mock-fetch-options'
import { badResponseCodes } from '@test/utils'
import { describe, expect, test } from 'vitest'
import {
  getComponent,
  getComponentBuild,
  getComponentBuilds,
  getComponentConfig,
  getLatestComponentBuild,
} from './components'

describe('getComponent should handle response status codes from GET components/:id endpoint', () => {
  const orgId = 'test-id'
  const componentId = 'test-id'
  test('200 status', async () => {
    const spec = await getComponent({ componentId, orgId })
    expect(spec).toHaveProperty('id')
    expect(spec).toHaveProperty('name')
  })

  test.each(badResponseCodes)('%s status', async () => {
    await getComponent({ componentId, orgId }).catch((err) =>
      expect(err).toMatchSnapshot()
    )
  })
})

describe('getComponentConfig should handle response status codes from GET components/:id/configs endpoint', () => {
  const orgId = 'test-id'
  const componentId = 'test-id'
  const componentConfigId = 'test-id'
  /*
    @FIXME: @nnnnat
    getComponentConfig filters on config ID which is dynamically generated by faker
    and will never be the same as the provided config ID
    therefor the returned spec will always null

    @TODO: add get component config by id path to rest api
  */
  test('200 status', async () => {
    const spec = await getComponentConfig({
      componentId,
      componentConfigId,
      orgId,
    })
    expect(spec).toBeUndefined()
    // expect(spec).toHaveProperty('id')
    // expect(spec).toHaveProperty('version')
  })

  test.each(badResponseCodes)('%s status', async () => {
    await getComponentConfig({ componentId, componentConfigId, orgId }).catch(
      (err) => expect(err).toMatchSnapshot()
    )
  })
})

describe('getComponentBuild should handle response status codes from GET builds/:id endpoint', () => {
  const orgId = 'test-id'
  const buildId = 'test-id'
  test('200 status', async () => {
    const spec = await getComponentBuild({ buildId, orgId })
    expect(spec).toHaveProperty('id')
    expect(spec).toHaveProperty('status')
  })

  test.each(badResponseCodes)('%s status', async () => {
    await getComponentBuild({ buildId, orgId }).catch((err) =>
      expect(err).toMatchSnapshot()
    )
  })
})

describe('getComponentBuilds should handle response status codes from GET components/:id/builds endpoint', () => {
  const orgId = 'test-id'
  const componentId = 'test-id'
  test('200 status', async () => {
    const spec = await getComponentBuilds({ componentId, orgId })
    spec.forEach((s) => {
      expect(s).toHaveProperty('id')
      expect(s).toHaveProperty('status')
    })
  })

  test.each(badResponseCodes)('%s status', async () => {
    await getComponentBuilds({ componentId, orgId }).catch((err) =>
      expect(err).toMatchSnapshot()
    )
  })
})

describe('getLatestComponentBuild should handle response status codes from GET components/:id/builds/latest endpoint', () => {
  const orgId = 'test-id'
  const componentId = 'test-id'
  test('200 status', async () => {
    const spec = await getLatestComponentBuild({ componentId, orgId })
    expect(spec).toHaveProperty('id')
    expect(spec).toHaveProperty('status')
  })

  test.each(badResponseCodes)('%s status', async () => {
    await getLatestComponentBuild({ componentId, orgId }).catch((err) =>
      expect(err).toMatchSnapshot()
    )
  })
})
