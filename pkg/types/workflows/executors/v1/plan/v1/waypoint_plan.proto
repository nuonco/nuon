syntax = "proto3";

package executors.v1.plan.v1;

import "component/v1/component.proto";
import "executors/v1/plan/v1/acr_repository_ref.proto";
import "executors/v1/plan/v1/ecr_repository_ref.proto";
import "executors/v1/plan/v1/git_source.proto";
import "executors/v1/plan/v1/metadata.proto";
import "executors/v1/plan/v1/waypoint_job.proto";
import "executors/v1/plan/v1/waypoint_ref.proto";
import "executors/v1/plan/v1/waypoint_runner.proto";
import "executors/v1/plan/v1/waypoint_server.proto";
import "tagger/tagger.proto";
import "validate/validate.proto";
import "variables/v1/variables.proto";

option go_package = "github.com/powertoolsdev/mono/pkg/types/workflows/executors/v1/plan/v1";

// WaypointPlan represents a waypoint plan used for builds or deploys.
message WaypointPlan {
  Metadata metadata = 1;
  WaypointServerRef waypoint_server = 2;
  ECRRepositoryRef ecr_repository_ref = 3;
  ACRRepositoryRef acr_repository_ref = 11;
  WaypointRef waypoint_ref = 4;
  WaypointJob waypoint_job = 5;
  WaypointRunner waypoint_runner = 6;
  Outputs outputs = 7;
  component.v1.Component component = 8;
  GitSource git_source = 9;
  variables.v1.Variables variables = 10;
}

// Outputs represent the outputs of the actual plan, such as where different files will be stored etc.
message Outputs {
  string bucket = 1 [
    (validate.rules).string.min_len = 1,
    (tagger.tags) = "faker:\"len=10\""
  ];

  // This is now deprecated in favor of job_prefix but retained for compatibility
  string bucket_prefix = 2 [(validate.rules).string.min_bytes = 1];

  // This path is for data specific to a given job run.
  // It has "write once" semantics and is immutable.
  string job_prefix = 7 [(validate.rules).string.min_bytes = 1];

  // This is a "fixed" path to get the most recent outputs for this component instance.
  // The files under this path are mutable and get overwritten with each new deployment.
  string instance_prefix = 8 [(validate.rules).string.min_bytes = 1];

  string bucket_assume_role_arn = 3 [
    (validate.rules).string.min_len = 20,
    (tagger.tags) = "faker:\"len=25\""
  ];

  string logs_key = 4 [(validate.rules).string.min_bytes = 1];
  string events_key = 5 [(validate.rules).string.min_bytes = 1];
  string artifact_key = 6 [(validate.rules).string.min_bytes = 1];
}
